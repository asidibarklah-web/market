<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oubrou Market</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }

/* Product card */
.product-card, .admin-product-card {
  transition: all 0.4s ease; border-radius: 1rem; overflow: hidden;
  background: linear-gradient(135deg,#6d5dfc,#c084fc); color:white;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25); position: relative;
}
.product-card:hover, .admin-product-card:hover {
  transform: translateY(-6px) scale(1.03);
  box-shadow: 0 16px 32px rgba(0,0,0,0.35);
}

/* Product Image */
.product-img-container, .admin-img-container {
  width:100%; 
  aspect-ratio: 1.2; /* maintain proportional height */
  overflow:hidden; 
  border-radius:1rem; 
  background:#f0f4f8; 
  display:flex; align-items:center; justify-content:center;
}
.product-img-container img, .admin-img-container img {
  width:100%; 
  height:100%; 
  object-fit: contain; /* keep full image clear */
  transition: transform 0.3s;
}
.product-img-container img:hover, .admin-img-container img:hover {
  transform: scale(1.05);
}

/* Cart */
.cart-slide {
  transition: right 0.5s ease-in-out;
  background: #4f46e5; color:white; border-radius:1.5rem 0 0 1.5rem;
  position: fixed; top:0; right:-480px; width:480px; height:100%; z-index:50;
  display:flex; flex-direction:column; padding:30px; box-shadow: -4px 0 30px rgba(0,0,0,0.4);
}
.cart-slide.open { right:0; }
.cart-item {
  display:flex; align-items:center; justify-content:space-between;
  background: rgba(255,255,255,0.15); border-radius:1rem; padding:0.5rem; margin-bottom:0.7rem;
  transition: all 0.3s;
}
.cart-item:hover { background: rgba(255,255,255,0.25); }
.cart-item img { border-radius:0.75rem; width:60px; height:60px; object-fit:cover; }
.cart-item-name { flex:1; margin-left:10px; font-weight:600; }

/* Total box */
.cart-total {
  background: linear-gradient(135deg,#6d5dfc,#c084fc); 
  padding:15px; border-radius:1rem; text-align:center; font-weight:bold; font-size:1.3rem;
  margin-top:10px; box-shadow:0 8px 20px rgba(0,0,0,0.3);
}

/* Buttons */
.gradient-btn { background: linear-gradient(135deg,#6d5dfc,#c084fc); color:white; font-weight:600; transition: all 0.3s; }
.gradient-btn:hover { background: linear-gradient(135deg,#c084fc,#6d5dfc); }

/* Checkout */
.checkout-item {
  display:flex; justify-content:space-between; align-items:center; padding:8px;
  border-radius:1rem; background:#eef2ff; color:#4f46e5; box-shadow:0 4px 12px rgba(0,0,0,0.2); margin-bottom:5px;
}

/* Admin Panel */
input { outline:none; }
input:focus { border-color:#6d5dfc; box-shadow:0 0 10px rgba(109,93,252,0.5); }
</style>
</head>
<body>

<header class="sticky top-0 z-50 bg-white shadow-md backdrop-blur-md bg-opacity-90">
  <div class="container mx-auto flex justify-between items-center p-4">
    <h2 class="text-3xl font-bold text-indigo-600">üõí Oubrou Market</h2>
    <div class="flex items-center gap-4">
      <button onclick="toggleCart()" class="relative gradient-btn px-5 py-2 rounded-full shadow-lg">
        Cart <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-6 h-6 flex items-center justify-center rounded-full">0</span>
      </button>
      <button onclick="showAdminLogin()" class="bg-gray-100 px-5 py-2 rounded-full shadow hover:bg-gray-200">Admin</button>
    </div>
  </div>
</header>

<section id="shop" class="container mx-auto p-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></section>

<!-- Cart -->
<div id="cartBox" class="cart-slide">
  <h2 class="text-2xl font-bold mb-5 border-b pb-2 text-center">üõí Your Cart</h2>
  <div id="cartItems" class="flex-1 overflow-y-auto space-y-3"></div>
  <div class="cart-total">Total: <span id="cartTotal">0</span> DH</div>
  <button onclick="openCheckout()" class="mt-4 w-full gradient-btn py-3 rounded-full shadow-lg">Checkout</button>
  <button onclick="toggleCart()" class="mt-3 w-full bg-red-500 py-3 rounded-full shadow hover:bg-red-600">Close</button>
</div>

<!-- Checkout -->
<div id="checkoutBox" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 backdrop-blur-sm">
  <div class="bg-white p-6 rounded-3xl w-96 max-h-[90vh] overflow-auto shadow-2xl">
    <h2 class="text-2xl font-bold mb-4 text-indigo-600 text-center">Checkout</h2>
    <div id="checkoutItems" class="space-y-2 mb-4"></div>
    <div class="cart-total" id="checkoutTotalBox">Total: <span id="checkoutTotal">0</span> DH</div>
    <button onclick="confirmOrder()" class="mt-4 w-full bg-green-600 text-white py-3 rounded-full shadow hover:bg-green-700">Confirm Order</button>
    <button onclick="closeCheckout()" class="mt-2 w-full bg-red-500 text-white py-3 rounded-full shadow hover:bg-red-600">Cancel</button>
  </div>
</div>

<!-- Admin Login -->
<div id="adminLoginBox" class="container mx-auto mt-6 p-6 max-w-md bg-white shadow-xl rounded-3xl hidden">
  <h2 class="text-2xl font-bold mb-5 text-center text-indigo-600">Admin Login</h2>
  <div class="relative mb-5">
    <input id="adminPassword" type="password" class="border w-full p-3 rounded-xl" placeholder="Password">
    <button type="button" onclick="togglePassword()" class="absolute right-3 top-3 text-gray-600">üëÅ</button>
  </div>
  <button onclick="loginAdmin()" class="w-full gradient-btn py-3 rounded-full shadow-lg">Login</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="fixed inset-0 bg-white hidden p-6 overflow-auto z-50 flex justify-center items-start">
  <div class="admin-panel w-full max-w-3xl">
    <button onclick="closeAdmin()" class="text-red-500 mb-4">‚Üê Exit</button>
    <h2 class="text-3xl font-bold mb-6 text-center text-indigo-600">Admin Panel</h2>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
      <input id="pName" class="border p-3 w-full rounded-xl" placeholder="Product Name">
      <input id="pPrice" type="number" class="border p-3 w-full rounded-xl" placeholder="Price">
      <input id="pTotal" type="number" class="border p-3 w-full rounded-xl" placeholder="Total Capacity">
      <input id="pCurrent" type="number" class="border p-3 w-full rounded-xl" placeholder="Current Capacity">
      <input id="pImage" class="border p-3 w-full rounded-xl" placeholder="Image URL">
      <input id="pProdDate" type="date" class="border p-3 w-full rounded-xl" placeholder="Production Date">
      <input id="pExpDate" type="date" class="border p-3 w-full rounded-xl" placeholder="Expiration Date">
    </div>

    <!-- Image Preview + Slider -->
    <div class="mb-4">
      <label class="font-bold mb-1 block">Product Image Preview:</label>
      <div class="w-full h-40 mb-2 border rounded-xl overflow-hidden flex items-center justify-center">
        <img id="previewImage" src="https://via.placeholder.com/250" class="max-h-full transition-transform" />
      </div>
      <input id="imageSlider" type="range" min="50" max="300" value="250" class="w-full">
    </div>

    <button onclick="saveProduct()" class="w-full gradient-btn py-3 rounded-full shadow-lg mb-4">Save Product</button>
    <h3 class="font-bold text-lg mb-2 text-center text-indigo-700">Products List</h3>
    <div id="adminList" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
  </div>
</div>

<script>
// ================= DATA =================
let products = JSON.parse(localStorage.getItem('products')) || [];
let cart = [];
let editIndex = null;
const ADMIN_PASSWORD = 'Oubrou123';
function saveToStorage(){ localStorage.setItem('products', JSON.stringify(products)); }

// ================= ADMIN =================
function showAdminLogin(){ document.getElementById('adminLoginBox').classList.remove('hidden'); }
function togglePassword(){ const input=document.getElementById('adminPassword'); input.type=input.type==='password'?'text':'password'; }
function loginAdmin(){ 
  if(document.getElementById('adminPassword').value===ADMIN_PASSWORD){ 
    document.getElementById('adminLoginBox').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    renderAdmin(); 
  } else alert('Wrong password'); 
}
function closeAdmin(){ document.getElementById('adminPanel').classList.add('hidden'); }

// ================= SHOP =================
function renderShop(){
  const shop=document.getElementById('shop'); 
  shop.innerHTML='';
  products.forEach((p,i)=>{
    shop.innerHTML+=`
    <div class="product-card">
      <div class="product-img-container"><img src="${p.image}" alt="${p.name}"></div>
      <div class="p-4">
        <h3 class="font-bold mt-2">${p.name}</h3>
        <p class="text-lg font-semibold">${p.price} DH</p>
        <p>Stock: ${p.current}/${p.total}</p>
        <p>Prod: ${p.prodDate || '-'} | Exp: ${p.expDate || '-'}</p>
        <button onclick="addToCart(${i})" class="mt-2 w-full py-2 rounded-full shadow gradient-btn">Add to cart</button>
      </div>
    </div>
    `;
  });
}

// ================= ADMIN LIST =================
function renderAdmin(){
  const adminList=document.getElementById('adminList'); 
  adminList.innerHTML='';
  products.forEach((p,i)=>{
    adminList.innerHTML+=`
    <div class="admin-product-card">
      <div class="admin-img-container"><img src="${p.image}" alt="${p.name}"></div>
      <div class="p-3">
        <h4 class="font-bold">${p.name}</h4>
        <p class="text-lg font-semibold">Price: ${p.price} DH</p>
        <p>Stock: ${p.current}/${p.total}</p>
        <p>Prod: ${p.prodDate || '-'} | Exp: ${p.expDate || '-'}</p>
        <div class="flex gap-2 mt-2">
          <button onclick="editProduct(${i})" class="w-1/2 py-1 rounded-full shadow bg-yellow-400">Edit</button>
          <button onclick="deleteProduct(${i})" class="w-1/2 py-1 rounded-full shadow bg-red-500">Delete</button>
        </div>
      </div>
    </div>`;
  });
}

// ================= SAVE/EDIT/DELETE =================
function saveProduct(){
  const name=document.getElementById('pName').value;
  const price=Number(document.getElementById('pPrice').value);
  const total=Number(document.getElementById('pTotal').value);
  const current=Number(document.getElementById('pCurrent').value);
  const image=document.getElementById('pImage').value||'https://via.placeholder.com/250';
  const prodDate=document.getElementById('pProdDate').value;
  const expDate=document.getElementById('pExpDate').value;
  if(!name||!price||!total||!current||!prodDate||!expDate){alert('Fill all fields'); return;}
  const newProduct={id:Date.now(), name, price, total, current, image, prodDate, expDate};
  if(editIndex!==null){ products[editIndex]=newProduct; editIndex=null; } else products.push(newProduct);
  saveToStorage(); clearAdminInputs(); renderShop(); renderAdmin();
}
function clearAdminInputs(){
  document.getElementById('pName').value=''; document.getElementById('pPrice').value='';
  document.getElementById('pTotal').value=''; document.getElementById('pCurrent').value='';
  document.getElementById('pImage').value=''; document.getElementById('pProdDate').value='';
  document.getElementById('pExpDate').value=''; document.getElementById('previewImage').src='https://via.placeholder.com/250'; document.getElementById('imageSlider').value=250;
}
function editProduct(i){
  const p=products[i]; editIndex=i;
  document.getElementById('pName').value=p.name;
  document.getElementById('pPrice').value=p.price;
  document.getElementById('pTotal').value=p.total;
  document.getElementById('pCurrent').value=p.current;
  document.getElementById('pImage').value=p.image;
  document.getElementById('pProdDate').value=p.prodDate;
  document.getElementById('pExpDate').value=p.expDate;
  document.getElementById('previewImage').src=p.image;
  document.getElementById('imageSlider').value=250;
}
function deleteProduct(i){ products.splice(i,1); saveToStorage(); renderShop(); renderAdmin(); }

// ================= CART =================
function toggleCart(){ document.getElementById('cartBox').classList.toggle('open'); }
function addToCart(i){ 
  const prod=products[i]; 
  if(prod.current<=0){alert('Out of stock'); return;} 
  cart.push({...prod}); 
  prod.current--; saveToStorage(); 
  document.getElementById('cartCount').innerText=cart.length; renderShop(); renderCart();
}
function removeFromCart(i){ 
  const prod=cart[i]; 
  const original=products.find(p=>p.id===prod.id); if(original){original.current++; saveToStorage();} 
  cart.splice(i,1); document.getElementById('cartCount').innerText=cart.length; renderShop(); renderCart();
}
function renderCart(){
  const cartItems=document.getElementById('cartItems'); cartItems.innerHTML=''; let total=0;
  cart.forEach((p,i)=>{ total+=p.price; 
    cartItems.innerHTML+=`<div class="cart-item">
      <div class="flex items-center"><img src="${p.image}"><span class="cart-item-name">${p.name}</span></div>
      <div>${p.price} DH <button onclick="removeFromCart(${i})" class="text-red-500 ml-2">x</button></div>
    </div>`; 
  });
  document.getElementById('cartTotal').innerText=total;
}

// ================= CHECKOUT =================
function openCheckout(){ 
  if(cart.length===0){alert('Cart is empty'); return;} 
  document.getElementById('checkoutBox').classList.remove('hidden'); 
  const checkoutItems=document.getElementById('checkoutItems'); checkoutItems.innerHTML=''; let total=0; 
  cart.forEach(p=>{ total+=p.price; 
    checkoutItems.innerHTML+=`<div class="checkout-item"><span>${p.name}</span><span>${p.price} DH</span></div>`; 
  });
  document.getElementById('checkoutTotal').innerText=total;
}
function closeCheckout(){ document.getElementById('checkoutBox').classList.add('hidden'); }
function confirmOrder(){ alert('Order confirmed!'); cart=[]; renderCart(); renderShop(); closeCheckout(); }

// ================= IMAGE PREVIEW + SLIDER =================
const pImageInput = document.getElementById('pImage');
const previewImage = document.getElementById('previewImage');
const imageSlider = document.getElementById('imageSlider');

pImageInput.addEventListener('input', ()=>{ previewImage.src = pImageInput.value || 'https://via.placeholder.com/250'; });
imageSlider.addEventListener('input', ()=>{ previewImage.style.height = imageSlider.value + 'px'; previewImage.style.width='auto'; });

// ================= INIT =================
renderShop(); renderAdmin();
</script>

</body>
</html>
